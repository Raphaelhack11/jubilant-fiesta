<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiveBridge - Children's Home Support</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles for GoFundMe Aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7; /* Light gray background */
        }
        .main-container {
            max-width: 500px;
            min-height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        .gfm-green-bg { background-color: #005537; }
        .gfm-green-text { color: #005537; }
        .gfm-green-hover:hover { background-color: #003321; }
        .page-header { background-color: #f7f7f7; }

        /* Custom Radio Button Styling for Payment Methods */
        .custom-radio-label input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            position: relative;
            outline: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-radio-label input[type="radio"]:checked {
            border-color: #005537;
        }

        .custom-radio-label input[type="radio"]:checked::before {
            content: '';
            width: 10px;
            height: 10px;
            background: #005537;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Skeleton Loading Effect */
        .skeleton {
            animation: pulse 1.5s infinite ease-in-out;
            background-color: #e2e8f0;
            border-radius: 4px;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Confetti Effect (Simple CSS/JS implementation) */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f0c808; /* Yellow */
            opacity: 0;
            animation: fall 5s infinite;
        }
        
        /* Define a few colors and delays */
        .confetti:nth-child(2n) { background-color: #ff5e5e; animation-delay: 0.5s; } /* Red */
        .confetti:nth-child(3n) { background-color: #4CAF50; animation-delay: 1s; } /* Green */
        .confetti:nth-child(4n) { background-color: #2196F3; animation-delay: 1.5s; } /* Blue */
        
        @keyframes fall {
            0% {
                transform: translate(0, -100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(calc(var(--rand-x) * 1px), 100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="flex justify-center">
    <div id="app" class="main-container flex flex-col">
        <!-- HEADER (Visible on all pages) -->
        <header class="page-header p-4 flex justify-between items-center border-b border-gray-200">
            <button id="backBtn" class="text-gray-600 hidden" onclick="goBack()">&larr; Back</button>
            <h1 class="text-xl font-bold gfm-green-text mx-auto">GiveBridge</h1>
        </header>

        <!-- PAGE 1: CAMPAIGN LANDING PAGE (Children's Homes Theme) -->
        <div id="page-campaign" class="p-6 transition-opacity duration-300">
            <div class="rounded-lg overflow-hidden mb-6">
                <!-- Image Placeholder updated for children's theme (Placeholder used as external images are not possible without local files) -->
                <img src="https://placehold.co/500x300/a8dadc/1d3557?text=Supporting+Orphaned+Children" alt="Campaign Image" class="w-full h-auto object-cover">
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg -mt-10 relative">
                <h2 class="text-2xl font-extrabold mb-2">Build a Future for Every Child</h2>
                <p class="text-sm text-gray-500 mb-4">You are supporting the GiveBridge Children's Orphanage Fund</p>
                
                <p class="text-gray-700 mb-6">
                    Every child deserves a safe place to call home. Your donation provides shelter, nutritious meals, essential education, and loving care for children in need at local orphanage homes. Help us ensure they have a happy, healthy childhood and a bright future.
                </p>
                
                <button id="startDonateBtn" class="w-full py-3 text-white font-bold rounded-xl gfm-green-bg gfm-green-hover transition duration-150 shadow-md">
                    Donate Now
                </button>
            </div>
        </div>

        <!-- PAGE 2: DONATION/CHECKOUT PAGE -->
        <div id="page-checkout" class="p-6 hidden transition-opacity duration-300">
            <h2 class="text-xl font-bold mb-4">Enter your donation</h2>
            
            <!-- Amount Buttons -->
            <div class="grid grid-cols-3 gap-3 mb-6">
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="50" type="button">$50</button>
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="100" type="button">$100</button>
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="200" type="button">$200</button>
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="300" type="button">$300</button>
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="500" type="button">$500</button>
                <button class="amount-btn bg-white border border-gray-300 text-lg font-semibold py-3 rounded-xl hover:border-blue-500 transition duration-150" data-value="1000" type="button">$1,000</button>
            </div>

            <!-- Custom Amount Input -->
            <div class="mb-6 flex items-center border-b-2 border-gray-300 py-2">
                <span class="text-2xl font-semibold mr-2 text-gray-500">$</span>
                <input
                    type="number"
                    id="donationInput"
                    placeholder="Other Amount"
                    min="1"
                    class="text-4xl font-extrabold w-full border-none focus:ring-0 focus:outline-none text-gray-800"
                />
            </div>

            <!-- Tip Section -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-bold mb-2">Tip GiveBridge services</h3>
                <p class="text-sm text-gray-600 mb-3">Optional: We rely on donors to fund our platform operations.</p>
                <div class="flex items-center space-x-2">
                    <input type="number" id="tipInput" min="0" step="0.01" class="w-24 p-2 border rounded-lg text-sm text-center bg-gray-50" readonly />
                    <span id="tipPercentDisplay" class="text-sm text-blue-600 font-semibold">(19.5%)</span>
                    <button id="tipToggleBtn" class="text-sm text-blue-600 hover:underline">Enter custom tip</button>
                </div>
            </div>

            <!-- Payment Method Selection -->
            <h3 class="font-bold mb-3">Payment Method</h3>
            <div class="flex flex-col space-y-2 mb-6">
                <!-- PayPal (Tag Hidden) -->
                <label class="custom-radio-label flex items-center p-4 border rounded-xl bg-white shadow-sm hover:border-gray-400 cursor-pointer">
                    <input type="radio" name="paymentMethod" value="paypal" data-details="@pamelaGeworsky" />
                    <span class="ml-3 font-medium flex-grow">PayPal</span>
                    <!-- Details hidden on this page -->
                </label>
                <!-- Bitcoin (Address Hidden) -->
                <label class="custom-radio-label flex items-center p-4 border rounded-xl bg-white shadow-sm hover:border-gray-400 cursor-pointer">
                    <input type="radio" name="paymentMethod" value="bitcoin" data-details="bc1q4c6f7xzsekkpvd2guwkaww4m7se9yjlrxnrjc7" />
                    <span class="ml-3 font-medium flex-grow">Bitcoin</span>
                    <!-- Details hidden on this page -->
                </label>
            </div>

            <!-- Checkout Summary -->
            <div class="border-t border-b py-3 mb-6">
                <div class="flex justify-between text-gray-600 text-sm mb-1">
                    <span>Your donation:</span> <span id="summaryDonation">$0.00</span>
                </div>
                <div class="flex justify-between text-gray-600 text-sm mb-2">
                    <span>GiveBridge tip:</span> <span id="summaryTip">$0.00</span>
                </div>
                <div class="flex justify-between font-bold text-lg gfm-green-text">
                    <span>Total due today:</span> <span id="summaryTotal">$0.00</span>
                </div>
            </div>

            <button id="continueBtn" class="w-full py-3 text-white font-bold rounded-xl bg-gray-400 cursor-not-allowed transition duration-150" disabled>
                Continue
            </button>
        </div>

        <!-- PAGE 3: PAYMENT INSTRUCTIONS / VERIFICATION -->
        <div id="page-verify" class="p-6 hidden transition-opacity duration-300 flex-grow">
            <div id="instructionContent" class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 gfm-green-text mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd" />
                </svg>
                <h2 class="text-2xl font-bold mb-4">Complete Payment Manually</h2>
                <p class="text-gray-600 mb-6">
                    Please send the **exact total amount** shown below to the specified account, then click "I Paid - Verify".
                </p>

                <div class="bg-gray-100 p-4 rounded-xl mb-6">
                    <p class="text-lg text-gray-700 font-medium mb-1">Send Total:</p>
                    <p id="verifyTotal" class="text-3xl font-extrabold gfm-green-text mb-4">$0.00</p>
                    
                    <p class="text-lg text-gray-700 font-medium mb-1" id="verifyMethodTitle">PayPal Account:</p>
                    <p id="verifyDetails" class="text-lg font-mono break-all text-gray-800">...</p>
                    <button id="copyDetailsBtn" class="mt-3 text-blue-600 text-sm hover:underline">Copy Details</button>
                </div>
                
                <button id="verifyPaidBtn" class="w-full py-3 text-white font-bold rounded-xl bg-blue-600 hover:bg-blue-700 transition duration-150 shadow-md">
                    I Paid - Verify
                </button>
            </div>

            <!-- Skeleton Loader (Hidden) -->
            <div id="skeletonLoader" class="hidden mt-10 p-6 text-center">
                <h3 class="text-xl font-bold mb-6">Verifying your payment...</h3>
                <div class="space-y-4">
                    <div class="skeleton h-6 w-3/4 mx-auto"></div>
                    <div class="skeleton h-4 w-5/6 mx-auto"></div>
                    <div class="skeleton h-4 w-1/2 mx-auto"></div>
                    <div class="skeleton h-10 w-full mx-auto mt-8"></div>
                </div>
                <p class="text-gray-500 text-sm mt-6">This may take up to 10 seconds.</p>
            </div>
        </div>

        <!-- PAGE 4: THANK YOU PAGE -->
        <div id="page-thankyou" class="p-6 hidden transition-opacity duration-300 flex-grow relative overflow-hidden">
            <div id="confetti-holder" class="confetti-container"></div>
            <div class="text-center mt-20 p-8 bg-white rounded-xl shadow-2xl relative z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 gfm-green-text mx-auto mb-6" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <h2 class="text-4xl font-extrabold mb-4 gfm-green-text">You're Amazing!</h2>
                <p class="text-xl text-gray-700 mb-4">Thank you for your generous donation of</p>
                <p id="thankYouAmount" class="text-5xl font-extrabold mb-6 gfm-green-text">$0.00</p>
                <p class="text-lg text-gray-600">Your contribution goes directly to helping families rebuild their lives.</p>
                <a href="#" class="inline-block mt-8 text-blue-600 hover:underline">Share this campaign</a>
            </div>
        </div>

        <!-- FOOTER (Visible on all pages) -->
        <footer class="p-4 text-center text-xs text-gray-400 border-t mt-auto">
            Â© <span id="year"></span> GiveBridge. Built with care.
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const $ = id => document.getElementById(id);
            const $$ = selector => document.querySelectorAll(selector);

            // --- GLOBAL STATE ---
            let state = {
                currentPage: 'campaign',
                history: ['campaign'],
                donationAmount: 0,
                tipAmount: 0,
                totalAmount: 0,
                paymentMethod: null,
                paymentDetails: null,
                isCustomTip: false,
                isPaymentValid: false,
            };
            const DEFAULT_TIP_PERCENTAGE = 0.195;
            const MIN_DONATION = 5.00;
            const PAGES = {
                campaign: $('page-campaign'),
                checkout: $('page-checkout'),
                verify: $('page-verify'),
                thankyou: $('page-thankyou')
            };

            // --- UI ELEMENTS ---
            const backBtn = $('backBtn');
            const amountBtns = $$('.amount-btn');
            const donationInput = $('donationInput');
            const tipInput = $('tipInput');
            const tipPercentDisplay = $('tipPercentDisplay');
            const tipToggleBtn = $('tipToggleBtn');
            const paymentRadios = $$('input[name="paymentMethod"]');
            const continueBtn = $('continueBtn');

            const summaryDonation = $('summaryDonation');
            const summaryTip = $('summaryTip');
            const summaryTotal = $('summaryTotal');

            const verifyTotal = $('verifyTotal');
            const verifyMethodTitle = $('verifyMethodTitle');
            const verifyDetails = $('verifyDetails');
            const verifyPaidBtn = $('verifyPaidBtn');
            const copyDetailsBtn = $('copyDetailsBtn');
            const instructionContent = $('instructionContent');
            const skeletonLoader = $('skeletonLoader');

            // --- UTILITY FUNCTIONS ---
            const updateUI = () => {
                // Hide all pages
                Object.values(PAGES).forEach(page => page.classList.add('hidden'));

                // Show current page
                const currentPageElement = PAGES[state.currentPage];
                if (currentPageElement) {
                    currentPageElement.classList.remove('hidden');
                }

                // Update back button visibility
                if (state.currentPage === 'campaign' || state.currentPage === 'thankyou') {
                    backBtn.classList.add('hidden');
                } else {
                    backBtn.classList.remove('hidden');
                }

                // Update footer year
                $('year').textContent = new Date().getFullYear();
            };

            const goToPage = (pageName, isBack = false) => {
                if (!PAGES[pageName] && !isBack) return console.error('Invalid page name:', pageName);

                // Handle history tracking
                if (isBack) {
                    // Remove current page from history
                    if (state.history.length > 1) {
                        state.history.pop();
                    }
                    // Set current page to the new last element in history
                    state.currentPage = state.history[state.history.length - 1] || 'campaign';
                } else {
                    state.currentPage = pageName;
                    // Add new page to history only if it's different from the current last page
                    if (state.history[state.history.length - 1] !== pageName) {
                        state.history.push(pageName);
                    }
                }

                // Perform specific page setup before showing
                if (state.currentPage === 'verify') setupVerificationPage();
                if (state.currentPage === 'thankyou') setupThankYouPage();

                updateUI();
                window.scrollTo(0, 0); // Scroll to top on page change
            };

            window.goBack = () => {
                goToPage(null, true); // Signal backward navigation
            };

            const formatCurrency = (amount) => `$${(parseFloat(amount) || 0).toFixed(2)}`;
            
            // --- CORE LOGIC: CHECKOUT PAGE ---

            const updateCalculation = () => {
                // 1. Calculate Tip
                if (!state.isCustomTip) {
                    state.tipAmount = state.donationAmount * DEFAULT_TIP_PERCENTAGE;
                    tipInput.value = state.tipAmount.toFixed(2);
                    tipPercentDisplay.textContent = `(${DEFAULT_TIP_PERCENTAGE * 100}%)`;
                } else {
                    state.tipAmount = parseFloat(tipInput.value) || 0;
                    
                    // Input validation for tip (cannot be negative)
                    if (state.tipAmount < 0) {
                        state.tipAmount = 0;
                        tipInput.value = '0.00';
                    }

                    let percentage = state.donationAmount > 0 ? (state.tipAmount / state.donationAmount) * 100 : 0;
                    tipPercentDisplay.textContent = `(${percentage.toFixed(1)}%)`;
                }
                
                // 2. Calculate Total
                state.totalAmount = state.donationAmount + state.tipAmount;
                
                // 3. Update Summary Display
                summaryDonation.textContent = formatCurrency(state.donationAmount);
                summaryTip.textContent = formatCurrency(state.tipAmount);
                summaryTotal.textContent = formatCurrency(state.totalAmount);

                // 4. Update Continue Button state
                const methodSelected = state.paymentMethod !== null;
                const amountValid = state.donationAmount >= MIN_DONATION;

                state.isPaymentValid = methodSelected && amountValid;

                if (state.isPaymentValid) {
                    continueBtn.disabled = false;
                    continueBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    continueBtn.classList.add('gfm-green-bg', 'gfm-green-hover');
                    continueBtn.textContent = `Continue to Pay ${formatCurrency(state.totalAmount)}`;
                } else {
                    continueBtn.disabled = true;
                    continueBtn.classList.remove('gfm-green-bg', 'gfm-green-hover');
                    continueBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    continueBtn.textContent = "Continue";
                }
            };

            // --- EVENT LISTENERS: CHECKOUT PAGE ---

            // 1. Fixed Amount Buttons
            amountBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    amountBtns.forEach(b => b.classList.remove('gfm-green-bg', 'text-white'));
                    btn.classList.add('gfm-green-bg', 'text-white');
                    
                    state.donationAmount = parseFloat(btn.dataset.value);
                    donationInput.value = state.donationAmount.toFixed(2);
                    updateCalculation();
                });
            });

            // 2. Custom Amount Input
            donationInput.addEventListener('input', (e) => {
                // Input Sanitization: allow only numbers and one dot
                let value = e.target.value.replace(/[^0-9.]/g, ''); 
                const parts = value.split('.');
                if (parts.length > 2) { value = parts[0] + '.' + parts.slice(1).join(''); }
                e.target.value = value;
                
                state.donationAmount = parseFloat(value) || 0;
                
                // Deactivate buttons
                amountBtns.forEach(b => b.classList.remove('gfm-green-bg', 'text-white'));
                updateCalculation();
            });

            // 3. Tip Logic
            tipToggleBtn.addEventListener('click', () => {
                state.isCustomTip = !state.isCustomTip;
                tipToggleBtn.textContent = state.isCustomTip ? 'Use default tip' : 'Enter custom tip';
                tipInput.readOnly = !state.isCustomTip;
                
                // Update styling based on readOnly state
                if (!state.isCustomTip) {
                    tipInput.classList.remove('bg-white');
                    tipInput.classList.add('bg-gray-50');
                } else {
                    tipInput.classList.remove('bg-gray-50');
                    tipInput.classList.add('bg-white');
                    tipInput.focus();
                }
                updateCalculation();
            });

            tipInput.addEventListener('input', () => {
                if (state.isCustomTip) {
                    // Simple sanitization for tip input
                    let value = tipInput.value.replace(/[^0-9.]/g, ''); 
                    tipInput.value = value;
                    updateCalculation();
                }
            });

            // 4. Payment Method Selection
            paymentRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    // Update styling for the label to reflect selection
                    $$('.custom-radio-label').forEach(label => label.classList.remove('border-blue-500', 'ring-2', 'ring-blue-200'));
                    radio.parentElement.classList.add('border-blue-500', 'ring-2', 'ring-blue-200');

                    if (radio.checked) {
                        state.paymentMethod = radio.value;
                        state.paymentDetails = radio.dataset.details;
                        updateCalculation();
                    }
                });
            });

            // 5. Continue Button
            continueBtn.addEventListener('click', () => {
                if (state.isPaymentValid) {
                    goToPage('verify');
                } else {
                    // Provide silent feedback as alerts are forbidden
                    console.log(`Validation failed: Please select an amount (minimum ${formatCurrency(MIN_DONATION)}) and a payment method to continue.`);
                }
            });

            // --- CORE LOGIC: CAMPAIGN PAGE ---
            $('startDonateBtn').addEventListener('click', () => {
                goToPage('checkout');
            });


            // --- CORE LOGIC: VERIFICATION PAGE ---
            const setupVerificationPage = () => {
                // Reset loader state
                instructionContent.classList.remove('hidden');
                skeletonLoader.classList.add('hidden');
                verifyPaidBtn.disabled = false;
                
                // Populate instructions
                verifyTotal.textContent = formatCurrency(state.totalAmount);
                verifyDetails.textContent = state.paymentDetails;
                
                let methodTitle = state.paymentMethod.charAt(0).toUpperCase() + state.paymentMethod.slice(1);
                if (methodTitle === 'Paypal') methodTitle = 'PayPal Account:';
                if (methodTitle === 'Bitcoin') methodTitle = 'Bitcoin Wallet Address:';
                
                verifyMethodTitle.textContent = methodTitle;
            };

            verifyPaidBtn.addEventListener('click', () => {
                verifyPaidBtn.disabled = true;
                instructionContent.classList.add('hidden');
                skeletonLoader.classList.remove('hidden');
                
                // Simulate payment verification (10 second wait)
                setTimeout(() => {
                    goToPage('thankyou');
                }, 10000); 
            });

            copyDetailsBtn.addEventListener('click', () => {
                // Clipboard copy using document.execCommand (reliable in iFrames)
                try {
                    const el = document.createElement('textarea');
                    el.value = state.paymentDetails;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    // Provide silent feedback for successful copy
                    console.log('Payment details copied to clipboard!'); 
                } catch (err) {
                    console.error('Copy failed:', err);
                }
            });


            // --- CORE LOGIC: THANK YOU PAGE (Confetti) ---
            const setupThankYouPage = () => {
                $('thankYouAmount').textContent = formatCurrency(state.totalAmount);
                
                // Start the confetti
                startConfetti();
            };

            const startConfetti = () => {
                const holder = $('confetti-holder');
                holder.innerHTML = ''; // Clear previous confetti
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Randomize initial position and animation variables
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = confetti.style.width;
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = Math.random() * 3 + 4 + 's';
                    confetti.style.setProperty('--rand-x', Math.random() * 400 - 200); // Horizontal drift
                    
                    holder.appendChild(confetti);
                }
            };
            
            // --- INITIALIZATION ---
            updateUI();
            updateCalculation(); // Initial calculation for checkout page state
        });
    </script>
</body>
</html>

